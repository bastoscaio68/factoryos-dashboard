# MC-001 ‚Äî Memorial de C√°lculo
## PROJ-004: Trading Dashboard Quantitativo

> **Documento:** MC-001 (Memorial de C√°lculo)  
> **Projeto:** PROJ-004-trading-dashboard  
> **Vers√£o:** 1.0  
> **Data:** 2026-02-12  
> **Status:** GATE 1 ‚Äî Defini√ß√£o de M√©tricas

---

## üìä M√©tricas de Trading

### 1. PnL (Profit and Loss)

#### 1.1 PnL Realizado (Realized PnL)

**Defini√ß√£o:** Resultado financeiro das posi√ß√µes que foram fechadas (com take profit ou stop loss).

**F√≥rmula:**
```
PnL_Realizado = Œ£(PnL_de_cada_trade_fechado)

Para cada trade:
PnL_Trade = (Pre√ßo_Saida - Pre√ßo_Entrada) √ó Quantidade √ó Dire√ß√£o

Onde:
- Dire√ß√£o = +1 para posi√ß√µes long
- Dire√ß√£o = -1 para posi√ß√µes short
```

**Observa√ß√µes:**
- Resultados positivos = lucros
- Resultados negativos = preju√≠zos
- J√° considera fees de opera√ß√£o

**Exemplo:**
```
Trade Long: Entrada @50.000 | Sa√≠da @52.000 | Quantidade: 0,5 BTC
PnL = (52.000 - 50.000) √ó 0,5 = 1.000 USDT (lucro)
```

#### 1.2 PnL N√£o Realizado (Unrealized PnL)

**Defini√ß√£o:** Resultado te√≥rico das posi√ß√µes ainda abertas (mark-to-market).

**F√≥rmula:**
```
PnL_N√£o_Realizado = (Pre√ßo_Atual - Pre√ßo_Entrada) √ó Quantidade √ó Dire√ß√£o
```

**Observa√ß√µes:**
- Flutua em tempo real com o pre√ßo de mercado
- Representa o resultado "em aberto"
- N√£o considera fees de sa√≠da

#### 1.3 PnL Total

**F√≥rmula:**
```
PnL_Total = PnL_Realizado + PnL_N√£o_Realizado
```

---

### 2. Win Rate (Taxa de Acerto)

**Defini√ß√£o:** Percentual de trades lucrativos em rela√ß√£o ao total de trades fechados.

**F√≥rmula:**
```
Win_Rate = (N√∫mero de Trades Winners / Total de Trades Fechados) √ó 100
```

**Exemplo:**
```
20 trades winners em 50 trades fechados
Win_Rate = (20/50) √ó 100 = 40%
```

**Categoriza√ß√£o:**
| Win Rate | Classifica√ß√£o |
|----------|---------------|
| < 40% | Baixo |
| 40% - 50% | Regular |
| 50% - 60% | Bom |
| 60% - 70% | Muito Bom |
| > 70% | Excelente |

---

### 3. Profit Factor

**Defini√ß√£o:** Raz√£o entre o lucro bruto total e o preju√≠zo bruto total.

**F√≥rmula:**
```
Profit_Factor = Lucro_Bruto / Preju√≠zo_Bruto

Onde:
Lucro_Bruto = Œ£(PnL_positivo de todos os trades)
Preju√≠zo_Bruto = |Œ£(PnL_negativo de todos os trades)|  (valor absoluto)
```

**Interpreta√ß√£o:**
| Profit Factor | Classifica√ß√£o |
|---------------|---------------|
| < 1.0 | N√£o rent√°vel |
| 1.0 - 1.5 | Marginal |
| 1.5 - 2.0 | Bom |
| 2.0 - 3.0 | Muito Bom |
| > 3.0 | Excelente |

**Observa√ß√£o:** Um profit factor de 2.0 significa que o trader ganha 2 d√≥lares para cada 1 d√≥lar perdido.

---

### 4. Sharpe Ratio

**Defini√ß√£o:** Medida de risco-retorno que avalia o retorno excedente por unidade de volatilidade.

**F√≥rmula:**
```
Sharpe_Ratio = (R_p - R_f) / œÉ_p

Onde:
- R_p = Retorno m√©dio do portfolio (anualizado)
- R_f = Taxa livre de risco (anualizada, ex: 5% ao ano)
- œÉ_p = Desvio padr√£o dos retornos (anualizado)
```

**Para trades (per√≠odo definido):**
```
Sharpe_Ratio = (M√©dia_Di√°ria_PnL / Desvio_Padr√£o_Di√°rio_PnL) √ó ‚àö252

Ou simplificado:
Sharpe_Ratio = (M√©dia_PnL_por_Trade / Desvio_Padr√£o_PnL) √ó ‚àöN_Trades
```

**Interpreta√ß√£o:**
| Sharpe Ratio | Classifica√ß√£o |
|--------------|---------------|
| < 0.5 | Ruim |
| 0.5 - 1.0 | Razo√°vel |
| 1.0 - 2.0 | Bom |
| 2.0 - 3.0 | Muito Bom |
| > 3.0 | Excelente |

---

### 5. Drawdown M√°ximo (Max DD)

**Defini√ß√£o:** A maior queda percentual do capital desde o pico hist√≥rico.

**F√≥rmula:**
```
Drawdown_Percentual(t) = [(Peak(t) - Capital(t)) / Peak(t)] √ó 100

Max_DD = max(Drawdown_Percentual(t)) para todo t
```

**Exemplo de c√°lculo:**
```
Capital inicial: 10.000 USDT
Pico hist√≥rico: 12.000 USDT
Menor capital ap√≥s pico: 9.600 USDT

Drawdown = [(12.000 - 9.600) / 12.000] √ó 100 = 20%
```

**Classifica√ß√£o de Risco:**
| Max DD | Risco |
|--------|-------|
| < 10% | Baixo |
| 10% - 20% | Moderado |
| 20% - 30% | Alto |
| 30% - 50% | Muito Alto |
| > 50% | Cr√≠tico |

---

### 6. Taxa de Acerto por Perfil

**Defini√ß√£o:** Win rate calculado separadamente para cada perfil de opera√ß√£o.

**F√≥rmula:**
```
Win_Rate_Perfil(i) = (Trades_Winners(Perfil_i) / Total_Trades(Perfil_i)) √ó 100
```

**Perfis definidos no projeto:**
- Grid
- Trend Alta
- Trend Baixa
- Lateraliza√ß√£o
- Breakout

**Matriz de Performance por Perfil:**

| Perfil | Win Rate | PnL M√©dio | Trade Count |
|--------|----------|-----------|-------------|
| Grid | XX% | XXX USDT | N |
| Trend Alta | XX% | XXX USDT | N |
| Trend Baixa | XX% | XXX USDT | N |
| Lateraliza√ß√£o | XX% | XXX USDT | N |
| Breakout | XX% | XXX USDT | N |

---

### 7. Score de Performance por Regime

**Defini√ß√£o:** M√©trica composta que avalia a performance do trader em diferentes regimes de mercado.

**F√≥rmula:**
```
Score_Regime(i) = (PnL_Regime(i) / Risco_Regime(i)) √ó Confian√ßa_Regime(i)

Onde:
- PnL_Regime(i) = PnL acumulado no regime i
- Risco_Regime(i) = Drawdown m√°ximo no regime i
- Confian√ßa_Regime(i) = min(1, N_Trades_Regime(i) / 10)  (capped em 1.0)
```

**Regimes de Mercado BTC:**
| Regime | Identifica√ß√£o | Caracter√≠stica |
|--------|---------------|----------------|
| Trend Alta | EMA 50 > EMA 200 + Pre√ßo acima de ambos | Movimentos bullish sustentados |
| Trend Baixa | EMA 50 < EMA 200 + Pre√ßo abaixo de ambos | Movimentos bearish sustentados |
| Lateraliza√ß√£o | EMA 50 ‚âà EMA 200 + Pre√ßo oscilando | Baixa volatilidade direcional |
| Breakout | Volatilidade alta + Volume crescente | Rompimento de consolida√ß√£o |

---

## üéØ Scoring para IA Analyst

### F√≥rmula de Scoring Geral

**Defini√ß√£o:** Score consolidado que permite comparar e ranquear diferentes setups/perfis.

**F√≥rmula:**
```
IA_Score = Œ± √ó Score_PnL + Œ≤ √ó Score_Risco + Œ≥ √ó Score_Consistencia + Œ¥ √ó Score_Regime

Onde:
Œ± = 0.35 (peso PnL)
Œ≤ = 0.25 (peso Risco)
Œ≥ = 0.25 (peso Consist√™ncia)
Œ¥ = 0.15 (peso Regime)
```

**Componentes individuais:**

#### 1. Score PnL
```
Score_PnL = min(100, (PnL_Total / PnL_Target) √ó 100)

PnL_Target = Capital_Inicial √ó 0.10  (expectativa: 10% ao per√≠odo)
```

#### 2. Score Risco
```
Score_Risco = max(0, 100 - (Max_DD / 2))  (deduz 1 ponto para cada 2% de drawdown)
```

#### 3. Score Consist√™ncia
```
Score_Consistencia = Win_Rate √ó (Profit_Factor / 2)

Normalizado para 0-100
```

#### 4. Score Regime
```
Score_Regime = M√©dia dos Score_Regime(i) ponderada pelo tempo em cada regime
```

**Tabela de Classifica√ß√£o:**
| IA Score | Classifica√ß√£o | A√ß√£o Recomendada |
|----------|---------------|-------------------|
| 0 - 25 | Cr√≠tico | Revisar estrat√©gia completamente |
| 25 - 50 | Baixo | Ajustes significativos necess√°rios |
| 50 - 70 | Moderado | Otimiza√ß√µes pontuais |
| 70 - 85 | Bom | Manter e refinar |
| 85 - 95 | Muito Bom | Escalar opera√ß√µes |
| 95 - 100 | Excelente | Potencial de automa√ß√£o completa |

---

## üìà F√≥rmulas de Recomenda√ß√£o de Setup

### 1. Recomenda√ß√£o de Perfil por Regime

**F√≥rmula:**
```
Recomenda√ß√£o_Regime(i) = argmax(Perfil_j) [ Score_Regime(Perfil_j, Regime_i) ]

Seleciona o perfil com maior score hist√≥rico para o regime atual
```

### 2. Par√¢metros de Entrada Sugeridos

**F√≥rmula para Stop Loss:**
```
SL = Entrada √ó (1 - (Risco_Percentual / 100))

Exemplo: Risco de 2%
SL = 50.000 √ó (1 - 0.02) = 49.000 USDT
```

**F√≥rmula para Take Profit:**
```
TP = Entrada √ó (1 + (Recompensa_Percentual / 100))

Onde:
Recompensa_Percentual = Risco_Percentual √ó Ratio_Risco_Recompensa

Ratio_Risco_Recompensa padr√£o = 1:2 (recompensa 2√ó o risco)
```

### 3. Alavancagem √ìtima

**F√≥rmula:**
```
Alavancagem_√ìtima = (Capital_Dispon√≠vel / Capital_Necess√°rio) √ó (1 / Max_DD_Target)

Onde:
- Capital_Necess√°rio = (Entrada - SL) √ó Quantidade
- Max_DD_Target = drawdown m√°ximo aceit√°vel (ex: 10%)
```

**Limita√ß√£o:**
```
Alavancagem_M√°xima = min(Calculada, Limite_Plataforma)
```

### 4. Tamanho da Posi√ß√£o

**F√≥rmula:**
```
Tamanho_Posi√ß√£o = (Capital √ó Risco_Percentual) / (|Entrada - SL| / Entrada)

Exemplo:
Capital: 10.000 USDT
Risco: 2% (200 USDT)
Entrada: 50.000 USDT
SL: 49.000 USDT

Tamanho = 200 / (1.000 / 50.000) = 200 / 0.02 = 10.000 USDT = 0,2 BTC
```

### 5. Score de Confian√ßa da Recomenda√ß√£o

**F√≥rmula:**
```
Confian√ßa = min(100, (N_Trades_Similares / 20) √ó 50 + (Win_Rate_Similar √ó 50))

Onde:
- N_Trades_Similares = n√∫mero de trades hist√≥ricos com par√¢metros similares
- Win_Rate_Similar = win rate desses trades similares
```

---

## üîß F√≥rmulas de Regime de Mercado

### Identifica√ß√£o de Regime

**Trend For√ßa:**
```
Trend_For√ßa = (EMA_Fast - EMA_Slow) / EMA_Slow √ó 100

EMA_Fast = EMA(per√≠odo curto, ex: 9)
EMA_Slow = EMA(per√≠odo longo, ex: 21)
```

**Classifica√ß√£o:**
| Trend For√ßa | Regime |
|-------------|--------|
| > 2% | Trend Alta |
| < -2% | Trend Baixa |
| -2% a 2% | Lateraliza√ß√£o |

**Volatilidade:**
```
Volatilidade = (Alta_Baixa_24h / Pre√ßo_Fechamento) √ó 100

Baixa volatilidade: < 2%
Alta volatilidade: > 5%
```

**Score de Regime Atual:**
```
Score_Regime_Atual = normalize(Trend_For√ßa, -5, 5) √ó 50 + normalize(Volatilidade, 0, 10) √ó 50
```

---

## üìã Tabela de Refer√™ncia R√°pida

| M√©trica | F√≥rmula | Intervalo Ideal |
|---------|---------|-----------------|
| Win Rate | Winners / Total √ó 100 | > 50% |
| Profit Factor | Lucro_Bruto / \|Preju√≠zo_Bruto\| | > 1.5 |
| Sharpe Ratio | (Rp - Rf) / œÉp | > 1.0 |
| Max Drawdown | [(Peak - Trough) / Peak] √ó 100 | < 20% |
| IA Score | Œ±√óPnL + Œ≤√óRisco + Œ≥√óConsist + Œ¥√óRegime | > 70 |

---

## üìù Exemplo de C√°lculo Completo

### Dados de Entrada:
```
Per√≠odo: 30 dias
Total Trades: 50
Capital Inicial: 10.000 USDT
Capital Final: 12.500 USDT
Trades Winners: 28
Lucro Bruto: 3.500 USDT
Preju√≠zo Bruto: 1.000 USDT
Maior Drawdown: 8%
```

### C√°lculos:
```
PnL Total = 2.500 USDT (+25%)
Win Rate = (28/50) √ó 100 = 56%
Profit Factor = 3.500 / 1.000 = 3.5
Sharpe Ratio ‚âà 2.1 (assumindo volatilidade baixa)
Max DD = 8%

IA Score:
- Score PnL = (2.500 / 1.000) √ó 100 = 100 (superou target)
- Score Risco = 100 - (8/2) = 96
- Score Consist√™ncia = 56 √ó (3.5/2) = 98
- Score Regime = (depende do per√≠odo)

IA Score ‚âà 0.35√ó100 + 0.25√ó96 + 0.25√ó98 + 0.15√óXX ‚âà 95
```

---

## üöÄ Pr√≥ximos Passos (Gate 2)

- [ ] Implementar todas as f√≥rmulas no backend
- [ ] Criar endpoints de c√°lculo
- [ ] Configurar banco de dados para armazenar trades
- [ ] Desenvolver dashboard de visualiza√ß√£o

---

*Documento criado como parte do GATE 1 ‚Äî Defini√ß√£o de M√©tricas*  
*PROJ-004: Trading Dashboard Quantitativo*
